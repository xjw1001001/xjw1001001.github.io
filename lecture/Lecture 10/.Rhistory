df %>% top_n(10, Rank.GHG.14) %>%
ggplot(aes(GHG.direct.emissions.14)) +
geom_bar(aes(color=Industry.type), stat = "identity") +
theme_fivethirtyeight()
df %>% top_n(10, Rank.GHG.14) %>%
ggplot(aes(y=GHG.direct.emissions.14)) +
geom_bar(aes(color=Industry.type), stat = "identity") +
theme_fivethirtyeight()
df %>% top_n(10, Rank.GHG.14) %>%
ggplot(aes(y=GHG.direct.emissions.14, x = Facility.name)) +
geom_bar(aes(color=Industry.type), stat = "identity") +
theme_fivethirtyeight()
df %>% top_n(10, Rank.GHG.14) %>% arrange(Rank.GHG.14) %>%
ggplot(aes(y=GHG.direct.emissions.14, x = Facility.name)) +
geom_bar(aes(color=Industry.type), stat = "identity") +
theme_fivethirtyeight() +
labs(title="Facilities ranking vs. emissions for GHG",subtitle="For year 14, emission in pounds") +
theme(axis.text.x=element_text(size=8)) +
geom_label_repel(
aes(label=ifelse(GHG.direct.emissions.14 > 1.6e7,as.character(paste0(Facility.name,"\n",primary.industry,"\n",City,",",State)),"")),
force=100,alpha=.85,size=3) +
scale_x_log10() + scale_y_log10()
df %>% top_n(10, Rank.GHG.14) %>% arrange(Rank.GHG.14)
df %>% top_n(10, Rank.GHG.14) %>% arrange(GHG.direct.emissions.14) %>%
ggplot(aes(y=GHG.direct.emissions.14, x = Facility.name)) +
geom_bar(aes(color=Industry.type), stat = "identity") +
theme_fivethirtyeight() +
labs(title="Facilities ranking vs. emissions for GHG",subtitle="For year 14, emission in pounds") +
theme(axis.text.x=element_text(size=8)) +
geom_label_repel(
aes(label=ifelse(GHG.direct.emissions.14 > 1.6e7,as.character(paste0(Facility.name,"\n",primary.industry,"\n",City,",",State)),"")),
force=100,alpha=.85,size=3) +
scale_x_log10() + scale_y_log10()
df %>% top_n(10, GHG.direct.emissions.14) %>% arrange(GHG.direct.emissions.14) %>%
ggplot(aes(y=GHG.direct.emissions.14, x = Facility.name)) +
geom_bar(aes(color=Industry.type), stat = "identity") +
theme_fivethirtyeight() +
labs(title="Facilities ranking vs. emissions for GHG",subtitle="For year 14, emission in pounds") +
theme(axis.text.x=element_text(size=8)) +
geom_label_repel(
aes(label=ifelse(GHG.direct.emissions.14 > 1.6e7,as.character(paste0(Facility.name,"\n",primary.industry,"\n",City,",",State)),"")),
force=100,alpha=.85,size=3) +
scale_x_log10() + scale_y_log10()
df %>% top_n(10, Rank.GHG.14) %>% arrange(Rank.GHG.14) %>%
ggplot(aes(y=GHG.direct.emissions.14, x = Facility.name)) +
geom_bar(aes(color=Industry.type), stat = "identity") +
theme_fivethirtyeight() +
labs(title="Facilities ranking vs. emissions for GHG",subtitle="For year 14, emission in pounds") +
theme(axis.text.x=element_text(size=8))
df %>% top_n(10, Rank.GHG.14) %>%
ggplot(aes(y=GHG.direct.emissions.14, x = Facility.name)) +
geom_bar(aes(color=Industry.type), stat = "identity") +
theme_fivethirtyeight() +
labs(title="Facilities ranking vs. emissions for GHG",subtitle="For year 14, emission in pounds") +
theme(axis.text.x=element_text(size=8))
df %>% top_n(10, Rank.GHG.14) %>% arrange(Rank.GHG.14)
colnames(df)
df %>% top_n(10, Rank.GHG.14) %>%
arrange(Rank.GHG.14) %>%
select(Facility.name, GHG.direct.emissions.14)
df %>% top_n(10, Rank.GHG.14) %>%
arrange(Rank.GHG.14)
df %>% top_n(10, Rank.GHG.14) %>%
arrange(Rank.GHG.14) %>%
select(Facility.name, GHG.direct.emissions.14)
df %>% top_n(10, Rank.GHG.14) %>%
arrange(Rank.GHG.14) %>%
select(Facility.name, Rank.GHG.14)
df %>% top_n(10, Rank.GHG.14) %>%
arrange(Rank.GHG.14) %>%
select(Facility.name, Rank.GHG.14)
df %>% arrange(Rank.GHG.14) %>% head(10) %>%
select(Facility.name, Rank.GHG.14)
df %>% arrange(Rank.GHG.14) %>% head(10) %>%
select(Facility.name, GHG.direct.emissions.14)
df %>% arrange(Rank.GHG.14) %>% head(10) %>%
select(Facility.name, GHG.direct.emissions.14) %>%
ggplot(aes(y=GHG.direct.emissions.14, x = Facility.name)) +
geom_bar(aes(color=Industry.type), stat = "identity") +
theme_fivethirtyeight() +
labs(title="Facilities ranking vs. emissions for GHG",subtitle="For year 14, emission in pounds") +
theme(axis.text.x=element_text(size=8))
df %>% arrange(Rank.GHG.14) %>% head(10) %>%
select(Facility.name, GHG.direct.emissions.14,
Industry.type) %>%
ggplot(aes(y=GHG.direct.emissions.14, x = Facility.name)) +
geom_bar(aes(fill=Industry.type), stat = "identity") +
theme_fivethirtyeight() +
labs(title="Facilities ranking vs. emissions for GHG",subtitle="For year 14, emission in pounds") +
theme(axis.text.x=element_text(size=8))
df %>% arrange(Rank.GHG.14) %>% head(15) %>%
select(Facility.name, GHG.direct.emissions.14,
Industry.type) %>%
ggplot(aes(y=GHG.direct.emissions.14, x = Facility.name)) +
geom_bar(aes(fill=Industry.type), stat = "identity") +
theme_fivethirtyeight() +
labs(title="Facilities emissions for GHG top 15",subtitle="For year 14, emission in pounds") +
theme(axis.text.x=element_blank()
)
df %>% arrange(Rank.GHG.14) %>% head(15) %>%
select(Facility.name, GHG.direct.emissions.14,
Industry.type) %>%
ggplot(aes(y=GHG.direct.emissions.14, x = Facility.name)) +
geom_bar(aes(fill=Industry.type), stat = "identity") +
theme_fivethirtyeight() +
labs(title="Facilities emissions for GHG top 15",subtitle="For year 14, emission in pounds") +
theme(axis.text.x=element_blank())
df %>% arrange(Rank.TRI.14) %>% head(15) %>%
select(Facility.name, TRI.direct.emissions.14,
Industry.type) %>%
ggplot(aes(y=TRI.direct.emissions.14, x = Facility.name)) +
geom_bar(aes(fill=Industry.type), stat = "identity") +
theme_fivethirtyeight() +
labs(title="Facilities emissions for TRI top 15",subtitle="For year 14, emission in pounds") +
theme(axis.text.x=element_blank())
df %>% arrange(Rank.GHG.14) %>% head(15) %>%
select(Facility.name, GHG.direct.emissions.14,
Industry.type) %>%
ggplot(aes(y=GHG.direct.emissions.14, x = Facility.name)) +
geom_bar(aes(fill=Industry.type), stat = "identity") +
theme_fivethirtyeight() +
labs(title="Facilities emissions for GHG top 15",subtitle="For year 14, emission in pounds") +
theme(axis.text.x=element_blank())
df %>% arrange(Rank.TRI.14) %>% head(15) %>%
select(Facility.name, TRI.air.emissions.14,
Industry.type) %>%
ggplot(aes(y=TRI.air.emissions.14, x = Facility.name)) +
geom_bar(aes(fill=Industry.type), stat = "identity") +
theme_fivethirtyeight() +
labs(title="Facilities emissions for TRI top 15",subtitle="For year 14, emission in pounds") +
theme(axis.text.x=element_blank())
variable
TRI.sum<-data.frame(
df %>% dplyr::select(primary.industry,TRI.air.emissions.14 ,TRI.air.emissions.13, TRI.air.emissions.12, TRI.air.emissions.11, TRI.air.emissions.10) %>%
dplyr::group_by(primary.industry) %>% na.omit() %>%
dplyr::summarize(sum.TRI.10 = sum(TRI.air.emissions.10),
sum.TRI.11 = sum(TRI.air.emissions.11),
sum.TRI.12 = sum(TRI.air.emissions.12),
sum.TRI.13 = sum(TRI.air.emissions.13),
sum.TRI.14 = sum(TRI.air.emissions.14)))
temp.tri<-data.frame(TRI.sum %>% dplyr::select(-primary.industry) %>% t())
colnames(temp.tri)<-TRI.sum$primary.industry
rownames(temp.tri)<-1:nrow(temp.tri)
temp.tri$year<-c(2010:2014)
temp.tri.melt<-reshape2::melt(temp.tri,id="year")
ggplot(temp.tri.melt,aes(factor(year),value)) +
geom_line(size=2,alpha=1) +
geom_point(size=1,color='black') +
theme_fivethirtyeight() +
facet_warp(variable, ncol = 3) +
labs(title="Sum of TRI emission",
subtitle="in tons, across all States") +
theme(legend.position='bottom',legend.direction='horizontal',legend.text = element_text(size=7))
?facet_warp
TRI.sum<-data.frame(
df %>% dplyr::select(primary.industry,TRI.air.emissions.14 ,TRI.air.emissions.13, TRI.air.emissions.12, TRI.air.emissions.11, TRI.air.emissions.10) %>%
dplyr::group_by(primary.industry) %>% na.omit() %>%
dplyr::summarize(sum.TRI.10 = sum(TRI.air.emissions.10),
sum.TRI.11 = sum(TRI.air.emissions.11),
sum.TRI.12 = sum(TRI.air.emissions.12),
sum.TRI.13 = sum(TRI.air.emissions.13),
sum.TRI.14 = sum(TRI.air.emissions.14)))
temp.tri<-data.frame(TRI.sum %>% dplyr::select(-primary.industry) %>% t())
colnames(temp.tri)<-TRI.sum$primary.industry
rownames(temp.tri)<-1:nrow(temp.tri)
temp.tri$year<-c(2010:2014)
temp.tri.melt<-reshape2::melt(temp.tri,id="year")
ggplot(temp.tri.melt,aes(factor(year),value)) +
geom_line(size=2,alpha=1) +
geom_point(size=1,color='black') +
theme_fivethirtyeight() +
facet_wrap(variable, ncol = 3) +
labs(title="Sum of TRI emission",
subtitle="in tons, across all States") +
theme(legend.position='bottom',legend.direction='horizontal',legend.text = element_text(size=7))
TRI.sum<-data.frame(
df %>% dplyr::select(primary.industry,TRI.air.emissions.14 ,TRI.air.emissions.13, TRI.air.emissions.12, TRI.air.emissions.11, TRI.air.emissions.10) %>%
dplyr::group_by(primary.industry) %>% na.omit() %>%
dplyr::summarize(sum.TRI.10 = sum(TRI.air.emissions.10),
sum.TRI.11 = sum(TRI.air.emissions.11),
sum.TRI.12 = sum(TRI.air.emissions.12),
sum.TRI.13 = sum(TRI.air.emissions.13),
sum.TRI.14 = sum(TRI.air.emissions.14)))
temp.tri<-data.frame(TRI.sum %>% dplyr::select(-primary.industry) %>% t())
colnames(temp.tri)<-TRI.sum$primary.industry
rownames(temp.tri)<-1:nrow(temp.tri)
temp.tri$year<-c(2010:2014)
temp.tri.melt<-reshape2::melt(temp.tri,id="year")
ggplot(temp.tri.melt,aes(factor(year),value)) +
geom_line(size=2,alpha=1) +
geom_point(size=1,color='black') +
theme_fivethirtyeight() +
facet_wrap(~variable, ncol = 3) +
labs(title="Sum of TRI emission",
subtitle="in tons, across all States") +
theme(legend.position='bottom',legend.direction='horizontal',legend.text = element_text(size=7))
TRI.sum<-data.frame(
df %>% dplyr::select(primary.industry,TRI.air.emissions.14 ,TRI.air.emissions.13, TRI.air.emissions.12, TRI.air.emissions.11, TRI.air.emissions.10) %>%
dplyr::group_by(primary.industry) %>% na.omit() %>%
dplyr::summarize(sum.TRI.10 = sum(TRI.air.emissions.10),
sum.TRI.11 = sum(TRI.air.emissions.11),
sum.TRI.12 = sum(TRI.air.emissions.12),
sum.TRI.13 = sum(TRI.air.emissions.13),
sum.TRI.14 = sum(TRI.air.emissions.14)))
temp.tri<-data.frame(TRI.sum %>% dplyr::select(-primary.industry) %>% t())
colnames(temp.tri)<-TRI.sum$primary.industry
rownames(temp.tri)<-1:nrow(temp.tri)
temp.tri$year<-c(2010:2014)
temp.tri.melt<-reshape2::melt(temp.tri,id="year")
ggplot(temp.tri.melt,aes(factor(year),value, group = variable)) +
geom_line(size=2,alpha=1) +
geom_point(size=1,color='black') +
theme_fivethirtyeight() +
facet_wrap(~variable, ncol = 3) +
labs(title="Sum of TRI emission",
subtitle="in tons, across all States") +
theme(legend.position='bottom',legend.direction='horizontal',legend.text = element_text(size=7))
TRI.sum<-data.frame(
df %>% dplyr::select(primary.industry,TRI.air.emissions.14 ,TRI.air.emissions.13, TRI.air.emissions.12, TRI.air.emissions.11, TRI.air.emissions.10) %>%
dplyr::group_by(primary.industry) %>% na.omit() %>%
dplyr::summarize(sum.TRI.10 = sum(TRI.air.emissions.10),
sum.TRI.11 = sum(TRI.air.emissions.11),
sum.TRI.12 = sum(TRI.air.emissions.12),
sum.TRI.13 = sum(TRI.air.emissions.13),
sum.TRI.14 = sum(TRI.air.emissions.14)))
temp.tri<-data.frame(TRI.sum %>% dplyr::select(-primary.industry) %>% t())
colnames(temp.tri)<-TRI.sum$primary.industry
rownames(temp.tri)<-1:nrow(temp.tri)
temp.tri$year<-c(2010:2014)
temp.tri.melt<-reshape2::melt(temp.tri,id="year")
ggplot(temp.tri.melt,aes(factor(year),value, group = variable)) +
geom_line(size=2,alpha=1) +
geom_point(size=1,color='black') +
theme_fivethirtyeight() +
facet_wrap(~variable, ncol = 3) +
labs(title="Sum of TRI emission",
subtitle="in tons, across all States") +
theme(legend.position='bottom',legend.direction='horizontal',legend.text = element_text(size=7))
TRI.sum<-data.frame(
df %>% dplyr::select(primary.industry,TRI.air.emissions.14 ,TRI.air.emissions.13, TRI.air.emissions.12, TRI.air.emissions.11, TRI.air.emissions.10) %>%
dplyr::group_by(primary.industry) %>% na.omit() %>%
dplyr::summarize(sum.TRI.10 = sum(TRI.air.emissions.10),
sum.TRI.11 = sum(TRI.air.emissions.11),
sum.TRI.12 = sum(TRI.air.emissions.12),
sum.TRI.13 = sum(TRI.air.emissions.13),
sum.TRI.14 = sum(TRI.air.emissions.14)))
temp.tri<-data.frame(TRI.sum %>% dplyr::select(-primary.industry) %>% t())
colnames(temp.tri)<-TRI.sum$primary.industry
rownames(temp.tri)<-1:nrow(temp.tri)
temp.tri$year<-c(2010:2014)
temp.tri.melt<-reshape2::melt(temp.tri,id="year")
ggplot(temp.tri.melt,aes(factor(year),value, group = variable)) +
geom_line(size=2,alpha=1) +
geom_point(size=1,color='black') +
theme_fivethirtyeight() +
facet_wrap(~variable, ncol = 3, scales = "free") +
labs(title="Sum of TRI emission",
subtitle="in tons, across all States") +
theme(legend.position='bottom',legend.direction='horizontal',legend.text = element_text(size=7))
ggplot(temp.tri.melt,aes(factor(year),value, group = variable)) +
geom_line(size=2,alpha=1) +
geom_point(size=1,color='black') +
theme_fivethirtyeight() +
facet_wrap(~variable, ncol = 3, scales = "free") +
labs(title="Sum of TRI emission",
subtitle="in tons, across all States") +
theme(legend.position='bottom',legend.direction='horizontal',legend.text = element_text(size=7))
temp.tri.melt
TRI.sum<-data.frame(
df %>% dplyr::select(primary.industry,TRI.air.emissions.14 ,TRI.air.emissions.13, TRI.air.emissions.12, TRI.air.emissions.11, TRI.air.emissions.10) %>%
dplyr::group_by(primary.industry) %>% na.omit() %>%
dplyr::summarize(sum.TRI.10 = sum(TRI.air.emissions.10),
sum.TRI.11 = sum(TRI.air.emissions.11),
sum.TRI.12 = sum(TRI.air.emissions.12),
sum.TRI.13 = sum(TRI.air.emissions.13),
sum.TRI.14 = sum(TRI.air.emissions.14)))
temp.tri<-data.frame(TRI.sum %>% dplyr::select(-primary.industry) %>% t())
colnames(temp.tri)<-TRI.sum$primary.industry
rownames(temp.tri)<-1:nrow(temp.tri)
temp.tri$year<-c(2010:2014)
temp.tri.melt<-reshape2::melt(temp.tri,id="year")
ggplot(temp.tri.melt,aes(factor(year),value, group = variable)) +
geom_line(size=2,alpha=1) +
geom_point(size=1,color='black') +
theme_fivethirtyeight() +
facet_wrap(~variable, ncol = 3, scales = "free") +
labs(title="Sum of TRI emission",
subtitle="in tons, across all States") +
theme(legend.position='bottom',legend.direction='horizontal',legend.text = element_text(size=7))
TRI.sum<-data.frame(
df %>% dplyr::select(primary.industry,TRI.air.emissions.14 ,TRI.air.emissions.13, TRI.air.emissions.12, TRI.air.emissions.11, TRI.air.emissions.10) %>%
dplyr::group_by(primary.industry) %>% na.omit() %>%
dplyr::summarize(sum.TRI.10 = sum(TRI.air.emissions.10),
sum.TRI.11 = sum(TRI.air.emissions.11),
sum.TRI.12 = sum(TRI.air.emissions.12),
sum.TRI.13 = sum(TRI.air.emissions.13),
sum.TRI.14 = sum(TRI.air.emissions.14)))
temp.tri<-data.frame(TRI.sum %>% dplyr::select(-primary.industry) %>% t())
colnames(temp.tri)<-TRI.sum$primary.industry
rownames(temp.tri)<-1:nrow(temp.tri)
temp.tri$year<-c(2010:2014)
temp.tri.melt<-reshape2::melt(temp.tri,id="year")
ggplot(temp.tri.melt,aes(factor(year),value, group = variable)) +
geom_line(size=2,alpha=1) +
geom_point(size=1,color='black') +
theme_fivethirtyeight() +
facet_wrap(~variable, ncol = 3, scales = "free") +
labs(title="Sum of TRI emission",
subtitle="in tons, across all States") +
theme(legend.position='bottom',legend.direction='horizontal',legend.text = element_text(size=7))
GHG.sum<-data.frame(
df %>% dplyr::select(primary.industry,GHG.direct.emissions.14,GHG.direct.emissions.13,
GHG.direct.emissions.12,GHG.direct.emissions.11,GHG.direct.emissions.10) %>%
dplyr::group_by(primary.industry) %>% na.omit() %>%
dplyr::summarize(sum.GHG.10 = sum(GHG.direct.emissions.10),
sum.GHG.11 = sum(GHG.direct.emissions.11),
sum.GHG.12 = sum(GHG.direct.emissions.12),
sum.GHG.13 = sum(GHG.direct.emissions.13),
sum.GHG.14 = sum(GHG.direct.emissions.14)))
temp.ghg<-data.frame(GHG.sum %>% dplyr::select(-primary.industry) %>% t())
colnames(temp.ghg)<-GHG.sum$primary.industry
rownames(temp.ghg)<-1:nrow(temp.ghg)
temp.ghg$year<-c(2010:2014)
temp.ghg.melt<-reshape2::melt(temp.ghg,id="year")
ggplot(temp.ghg.melt,aes(factor(year),value, group = variable)) +
geom_line(size=2,alpha=1) +
geom_point(size=1,color='black') +
theme_fivethirtyeight() +
facet_wrap(~variable, ncol = 3, scales = "free") +
labs(title="Sum of GHG emission",
subtitle="in pounds, across all States") +
theme(legend.position='bottom',legend.direction='horizontal',legend.text = element_text(size=7))
ggplot(temp.ghg.melt,aes(factor(year),value, group = variable)) +
geom_line(size=2,alpha=1) +
geom_point(size=1,color='black') +
theme_fivethirtyeight() +
facet_wrap(~variable, ncol = 3, scales = "free") +
labs(title="Sum of GHG emission",
subtitle="in pounds, across all States") +
theme(legend.position='bottom',legend.direction='horizontal',legend.text = element_text(size=7))
makeMap<-function(temp,year,gaz){
temp$region<-sapply(temp$State, function(x) tolower(state.name[match(x, state.abb)]))
tt<-temp %>% dplyr::select(region,value) %>% na.omit() %>% dplyr::arrange(region)
choro = StateChoropleth$new(tt)
if(gaz=='GHG'){
choro$title  = paste0(2000 + year," GHG emission")
choro$ggplot_scale = scale_fill_manual(name="pounds", values = rev(viridis::magma(10)),drop=FALSE)
}
else if(gaz=='TRI'){
choro$title  = paste0(2000 + year," TRI emission")
choro$ggplot_scale = scale_fill_manual(name="tons", values = rev(viridis::magma(10)),drop=FALSE)
}
return(choro$render())
}
gaz_name<-c('TRI.air.emissions.','GHG.direct.emissions.')
for(gg in 1:length(gaz_name)){
for (i in 10:14){
x<-paste0(gaz_name[gg],i)
temp<-df %>% dplyr::select(State,.dots=x) %>% dplyr::group_by(State) %>% na.omit() %>% dplyr::summarize(value = sum(.dots))
if(grepl('TRI',x) == TRUE){
listPlot[[cnt]]<-makeMap(temp,i,'TRI')
}
else {
listPlot[[cnt]]<-makeMap(temp,i,'GHG')
}
cnt<-cnt+1
}
}
listPlot<-list()
cnt<-1
makeMap<-function(temp,year,gaz){
temp$region<-sapply(temp$State, function(x) tolower(state.name[match(x, state.abb)]))
tt<-temp %>% dplyr::select(region,value) %>% na.omit() %>% dplyr::arrange(region)
choro = StateChoropleth$new(tt)
if(gaz=='GHG'){
choro$title  = paste0(2000 + year," GHG emission")
choro$ggplot_scale = scale_fill_manual(name="pounds", values = rev(viridis::magma(10)),drop=FALSE)
}
else if(gaz=='TRI'){
choro$title  = paste0(2000 + year," TRI emission")
choro$ggplot_scale = scale_fill_manual(name="tons", values = rev(viridis::magma(10)),drop=FALSE)
}
return(choro$render())
}
gaz_name<-c('TRI.air.emissions.','GHG.direct.emissions.')
for(gg in 1:length(gaz_name)){
for (i in 10:14){
x<-paste0(gaz_name[gg],i)
temp<-df %>% dplyr::select(State,.dots=x) %>% dplyr::group_by(State) %>% na.omit() %>% dplyr::summarize(value = sum(.dots))
if(grepl('TRI',x) == TRUE){
listPlot[[cnt]]<-makeMap(temp,i,'TRI')
}
else {
listPlot[[cnt]]<-makeMap(temp,i,'GHG')
}
cnt<-cnt+1
}
}
grid.arrange(listPlot[[1]],listPlot[[6]],
listPlot[[2]],listPlot[[7]],
listPlot[[3]],listPlot[[8]],
listPlot[[4]],listPlot[[9]],
listPlot[[5]],listPlot[[10]],ncol=2)
listPlot<-list()
cnt<-1
makeMap<-function(temp,year,gaz){
temp$region<-sapply(temp$State, function(x) tolower(state.name[match(x, state.abb)]))
tt<-temp %>% dplyr::select(region,value) %>% na.omit() %>% dplyr::arrange(region)
choro = StateChoropleth$new(tt)
if(gaz=='GHG'){
choro$title  = paste0(2000 + year," GHG emission")
choro$ggplot_scale = scale_fill_manual(name="pounds", values = rev(viridis::magma(10)),drop=FALSE)
}
else if(gaz=='TRI'){
choro$title  = paste0(2000 + year," TRI emission")
choro$ggplot_scale = scale_fill_manual(name="tons", values = rev(viridis::magma(10)),drop=FALSE)
}
return(choro$render())
}
gaz_name<-c('TRI.air.emissions.','GHG.direct.emissions.')
for(gg in 1:length(gaz_name)){
for (i in 10:14){
x<-paste0(gaz_name[gg],i)
temp<-df %>% dplyr::select(State,.dots=x) %>% dplyr::group_by(State) %>% na.omit() %>% dplyr::summarize(value = sum(.dots))
if(grepl('TRI',x) == TRUE){
listPlot[[cnt]]<-makeMap(temp,i,'TRI')
}
else {
listPlot[[cnt]]<-makeMap(temp,i,'GHG')
}
cnt<-cnt+1
}
}
grid.arrange(listPlot[[1]],
listPlot[[2]],
listPlot[[3]],
listPlot[[4]],
listPlot[[5]],ncol=2)
makeMap<-function(temp,year,gaz){
temp$region<-sapply(temp$State, function(x) tolower(state.name[match(x, state.abb)]))
tt<-temp %>% dplyr::select(region,value) %>% na.omit() %>% dplyr::arrange(region)
choro = StateChoropleth$new(tt)
if(gaz=='GHG'){
choro$title  = paste0(2000 + year," GHG emission")
choro$ggplot_scale = scale_fill_manual(name="pounds", values = rev(viridis::magma(10)),drop=FALSE)
}
else if(gaz=='TRI'){
choro$title  = paste0(2000 + year," TRI emission")
choro$ggplot_scale = scale_fill_manual(name="tons", values = rev(viridis::magma(10)),drop=FALSE)
}
return(choro$render())
}
makeMap(temp,2014,'TRI')
makeMap(temp,2014,'GHG')
makeMap<-function(temp,year,gaz){
temp$region<-sapply(temp$State, function(x) tolower(state.name[match(x, state.abb)]))
tt<-temp %>% dplyr::select(region,value) %>% na.omit() %>% dplyr::arrange(region)
choro = StateChoropleth$new(tt)
if(gaz=='GHG'){
choro$title  = paste0(2000 + year," GHG emission")
choro$ggplot_scale = scale_fill_manual(name="pounds", values = rev(viridis::magma(10)),drop=FALSE)
}
else if(gaz=='TRI'){
choro$title  = paste0(2000 + year," TRI emission")
choro$ggplot_scale = scale_fill_manual(name="tons", values = rev(viridis::magma(10)),drop=FALSE)
}
return(choro$render())
}
temp = df %>% dplyr::select(State,.dots=x) %>% dplyr::group_by(State) %>% na.omit() %>% dplyr::summarize(value = sum(.dots))
makeMap(temp,2014,'TRI')
makeMap(temp,2014,'GHG')
makeMap<-function(temp,year,gaz){
temp$region<-sapply(temp$State, function(x) tolower(state.name[match(x, state.abb)]))
tt<-temp %>% dplyr::select(region,value) %>% na.omit() %>% dplyr::arrange(region)
choro = StateChoropleth$new(tt)
if(gaz=='GHG'){
choro$title  = paste0(2000 + year," GHG emission")
choro$ggplot_scale = scale_fill_manual(name="pounds", values = rev(viridis::magma(10)),drop=FALSE)
}
else if(gaz=='TRI'){
choro$title  = paste0(2000 + year," TRI emission")
choro$ggplot_scale = scale_fill_manual(name="tons", values = rev(viridis::magma(10)),drop=FALSE)
}
return(choro$render())
}
x<-paste0('TRI.air.emissions.',2014)
temp = df %>% dplyr::select(State,.dots=x) %>% dplyr::group_by(State) %>% na.omit() %>% dplyr::summarize(value = sum(.dots))
makeMap<-function(temp,year,gaz){
temp$region<-sapply(temp$State, function(x) tolower(state.name[match(x, state.abb)]))
tt<-temp %>% dplyr::select(region,value) %>% na.omit() %>% dplyr::arrange(region)
choro = StateChoropleth$new(tt)
if(gaz=='GHG'){
choro$title  = paste0(2000 + year," GHG emission")
choro$ggplot_scale = scale_fill_manual(name="pounds", values = rev(viridis::magma(10)),drop=FALSE)
}
else if(gaz=='TRI'){
choro$title  = paste0(2000 + year," TRI emission")
choro$ggplot_scale = scale_fill_manual(name="tons", values = rev(viridis::magma(10)),drop=FALSE)
}
return(choro$render())
}
x<-paste0('TRI.air.emissions.',14)
temp = df %>% dplyr::select(State,.dots=x) %>% dplyr::group_by(State) %>% na.omit() %>% dplyr::summarize(value = sum(.dots))
makeMap(temp,14,'TRI')
x<-paste0('GHG.direct.emissions.',14)
temp = df %>% dplyr::select(State,.dots=x) %>% dplyr::group_by(State) %>% na.omit() %>% dplyr::summarize(value = sum(.dots))
makeMap(temp,14,'GHG')
knitr::opts_chunk$set(
comment = "",eval = TRUE,fig.retina = 2, message=F, warning = F, fig.height = 4.5
)
library(renderthis)
to_pdf(from = "lecture11.html",complex_slides = TRUE)
