---
title: "STA 032 Homework 6"
author: "CHANGE YOUR NAME HERE"
date: "DUE: May 28 2023, 12PM"
output: 
  html_document: 
    toc: true
    toc_float: true
---

# Instructions

+ Upload a PDF file, named with your UC Davis email ID and homework number (e.g., `xjw18_hw6.pdf`), to Gradescope (accessible through Canvas). You will give the commands to answer each question in its own code block, which will also produce output that will be automatically embedded in the output file. When asked, answer must be supported by written statements as well as any code used. 

+ All code used to produce your results must be shown in your PDF file (e.g., do not use `echo = FALSE` or `include = FALSE` as options anywhere). `Rmd` files do not need to be submitted, but may be requested by the TA and must be available when the assignment is submitted.

+ Students may choose to collaborate with each other on the homework, but must clearly indicate with whom they collaborated. Every student must upload their own submission.

+ Start to work on it as early as possible. Finishing this homework can help prepare midterm 1.

+ When you want to show your result as a vector that is too long, slice the first 10 objects. When you want to show your result as a data frame, use `head()` on it. Failure to do so may lead to point deduction.

+ Directly knit the Rmd file will give you an html file. Open that file in your browser and then you can print it into a PDF file.

# Instructions for book problems:

You can use R markdown and mathematical typing to solve the book problems.

Or you can write the problems by hand, taking pictures and then convert them into a PDF file.

You can then Google `concatenate pdf files online` to merge the PDF files you have for R problems and book problems into 1 PDF file for gradescope submission.

You may also handwrite your answer, take pictures, and then include an image in a code chunk using `knitr::include_graphics("myImg.png")`.) 

```{r setup, include=FALSE}
# Don't change anything here
knitr::opts_chunk$set(
  comment = "", prompt = F, message=F, warning = F
)
```


```{r}
# Load necessary libraries
library(tidyverse)
```


One 5★ Character and three 4★ Characters will be featured on any given Character Oriented Warp,
The rate for pulling a 5★ Character from this banner is currently set at 0.6%,
The rate for pulling a 4★ Character from this banner is currently set at 5.1%,
Otherwise the result is 3★ light cone.

Once you pull a 5★ Character, you have 50% chance of it being the Rate-up one,
If you lose the 50/50 then the second 5★ Character you pull will 100% be the Rate-up one,
You are guaranteed to obtain a 5★ within 90 pulls (that's the pity). So if you're unlucky, it will take you at most 180 pulls to get the rate-up character.
Once you pull a 4★ Character, you have 50% chance of it being the Rate-up one,

4★ Characters: Arlan, Asta, Dan Heng, Herta, Hook, March 7th, Natasha, Pela, Qingque, Sampo
,Serval, Sushang,Tingyun
5★Characters: Bailu, Bronya, Clara, Gepard, Himeko, Seele, Welt, Yanqing

Rate-up:5★ Seele; 4★Natasha, Hook, Pela

```{r}

starRail_pull = function(n_pulls = 1000){
  # Gacha parameters
  five_star_rate <- 0.006
  four_star_rate <- 0.051
  rate_up_five_star <- 0.5
  rate_up_four_star <- 0.5
  
  # Define characters
  four_star_characters <- c("Arlan", "Asta", "Dan Heng", "Herta", "Hook", 
                            "March 7th", "Natasha", "Pela", "Qingque", "Sampo", 
                            "Serval", "Sushang", "Tingyun")
  five_star_characters <- c("Bailu", "Bronya", "Clara", "Gepard", "Himeko", "Seele", "Welt", "Yanqing")
  rate_up_five_star_char <- "Seele"
  rate_up_four_star_chars <- c("Natasha", "Hook", "Pela")
  
  # Initialize counters
  pity_counter_five_star <- 0 # counts how many pulls no 5 star characters
  pity_counter_four_star_plus <- 0 # counts how many pulls no 4+ star characters
  last_five_star_not_up <- FALSE # counts whether the last 5 star character is not the up character
  pull_results <- vector(length = n_pulls)
  star_results <- vector(length = n_pulls)
  
  for(pull in 1:n_pulls) {
    # generate a random number to determine the pull result
    rand <- runif(1)
    pity_counter_four_star_plus <- 1 + pity_counter_four_star_plus
    pity_counter_five_star <- 1 + pity_counter_five_star
    # condition for a 5 star character
    # either this pull achieves 5 star rate or you haven't got 5 star in last 89 pulls
    if (rand <= five_star_rate || pity_counter_five_star >= 90) {
      # Lucky, got 5 star, so reset the counter.
      pity_counter_five_star <- 0
      pity_counter_four_star_plus <- 0
      # condition for a 5 star up character
      # either this pull achieves 5 star up rate or you the last 5 star is not the up character
      if (rand <= five_star_rate * rate_up_five_star || last_five_star_not_up == TRUE) {
        char <- rate_up_five_star_char
        star <- 5
      } else {
        # randomly choose 1 non-up 5 star character
        char <- sample(five_star_characters[five_star_characters != rate_up_five_star_char], 1)
        star <- 5
        # This 5 star is not up character
        last_five_star_not_up <- TRUE
      }
    }
    # When it's not 5 star character, but it's 4 star character 
    # (five_star_rate< rand <= (five_star_rate + four_star_rate))
    else if (rand <= (five_star_rate + four_star_rate) || pity_counter_four_star_plus >= 10) {
      pity_counter_four_star_plus <- 0
      # condition for a 4 star up character
      if (rand <= (five_star_rate + four_star_rate * rate_up_four_star)) {
        char <- sample(rate_up_four_star_chars, 1)
        star <- 4
      } else {
        char <- sample(four_star_characters[!four_star_characters %in% rate_up_four_star_chars], 1)
        star <- 4
      }
    } else {
      char <- "3★ light cone"
      star <- 3
    }
    pull_results[pull] <- char
    star_results[pull] <- star
  }
  print(table(pull_results))
  return(data.frame(result = pull_results, star = star_results, index = 1:n_pulls))
}


# Save pull results to a CSV file
#write.csv(data.frame(pull_results), "gacha_pull_results.csv", row.names = FALSE)
```

```{r}
df = starRail_pull(80)
print(table(df$star))
```




## Include the person you coop with:

Names:

## Appendix

```{r eval = TRUE}
sessionInfo()
```











